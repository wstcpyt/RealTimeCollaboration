<dom-module id="canvas-draw">
    <template>
        <canvas style="background-color: #00bcd4" id="canvasId" width="490" height="220"></canvas>
    </template>
</dom-module>

<script>
    Polymer({
        is:"canvas-draw",
        ready: function() {
            var clickX = [];
            var clickY = [];
            var clickDrag = [];
            var paint;
            var pixelDataRef = new Firebase('https://infomagnetic.firebaseio.com/draw');

            function addClick(x, y, dragging)
            {
                clickX.push(x);
                clickY.push(y);
                clickDrag.push(dragging);
            }

            function redraw(){
                context.clearRect(0, 0, context.canvas.width, context.canvas.height); // Clears the canvas

                context.strokeStyle = "#df4b26";
                context.lineJoin = "round";
                context.lineWidth = 5;

                for(var i=0; i < clickX.length; i++) {
                    context.beginPath();
                    if(clickDrag[i] && i){
                        context.moveTo(clickX[i-1], clickY[i-1]);
                    }else{
                        context.moveTo(clickX[i]-1, clickY[i]);
                    }
                    pixelDataRef.child(clickX[i] + ":" + clickY[i]).set("#df4b26");
                    context.lineTo(clickX[i], clickY[i]);
                    context.closePath();
                    context.stroke();
                }
            }

            var context = this.$$("#canvasId").getContext("2d");
            this.$$("#canvasId").onmousedown = function(e){
                var mouseX = e.pageX - this.getBoundingClientRect().left;
                var mouseY = e.pageY - this.getBoundingClientRect().top;
                console.log(this.getBoundingClientRect().top);
                paint = true;
                addClick(mouseX, mouseY);
                redraw();
            };

            this.$$("#canvasId").onmousemove = function(e){
                if(paint){
                    var mouseX = e.pageX - this.getBoundingClientRect().left;
                    var mouseY = e.pageY - this.getBoundingClientRect().top;
                    addClick(mouseX, mouseY, true);
                    redraw();
                }
            };
            this.$$("#canvasId").onmouseup = function (e) {
                paint = false;
            };

            this.$$("#canvasId").onmouseleave = function (e) {
                paint = false;
            }
        }
    })
</script>